<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <script>
    AFRAME.registerComponent('artwork-info', {
      init: function () {
        this.el.addEventListener('loaded', () => { 
          console.log("A-Frame Loaded!");

          // Get elements
          const infoPanel = document.querySelector("#info-box-1");
          const infoButton = document.querySelector("#more-info-button");
          const closeButton = document.querySelector("#close-btn-1");

          if (!infoPanel || !infoButton || !closeButton) {
            console.error("One or more elements are missing.");
            return;
          }

          // Make sure objects are interactive
          infoButton.classList.add("clickable");
          closeButton.classList.add("clickable");

          // Show info panel when button is clicked
          infoButton.addEventListener("click", () => {
            console.log("More Info Clicked!");
            infoPanel.setAttribute("visible", "true");
          });

          // Hide info panel when close button is clicked
          closeButton.addEventListener("click", () => {
            console.log("Close Button Clicked!");
            infoPanel.setAttribute("visible", "false");
          });
        });
      }
    });

    AFRAME.registerComponent('mytarget', {
      init: function () {
        this.el.addEventListener('targetFound', () => {
          console.log("Artwork detected!");
          document.querySelector("#more-info-button").setAttribute("visible", "true");
        });

        this.el.addEventListener('targetLost', () => {
          console.log("Artwork lost!");
          document.querySelector("#info-box-1").setAttribute("visible", "false");
          document.querySelector("#more-info-button").setAttribute("visible", "false");
        });
      }
    });
  </script>

</head>

<body>
  <a-scene
    mindar-image="imageTargetSrc:https://cdn.glitch.global/9b643d33-8eab-444c-bfc4-185db20906b5/9.-img-targets.mind?v=1739209316462; 
    filterMinCF: 0.5; 
    filterBeta: 10; 
    missTolerance: 5; 
    warmupTolerance: 5"
    vr-mode-ui="enabled: false"
    color-space="sRGB"
    renderer="colorManagement: true, physicallyCorrectLights"
    device-orientation-permission-ui="enabled: false"
  >

    <!-- Add Cursor for Clicking -->
    <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;" 
              raycaster="far: 10000; objects: .clickable">
    </a-camera>

    <!-- Target Image -->
    <a-entity mindar-image-target="targetIndex: 2" mytarget>

      <!-- "More Info" Image Button -->
      <a-image id="more-info-button" class="clickable" src="https://cdn.glitch.global/9b643d33-8eab-444c-bfc4-185db20906b5/more-info.png?v=1740476810453"
               alpha-test="0.5" position="0 -0.8 0" height="0.15" width="0.15">
              </a-image>
<!--       <a-plane id="" class="clickable"
               position="0 -0.8 0" width="0.5" height="0.2"
               material="src: https://cdn.glitch.global/9b643d33-8eab-444c-bfc4-185db20906b5/more-info.png?v=1740476810453" visible="false">
      </a-plane> -->

      <!-- Info Panel -->
      <a-entity id="info-box-1" position="0 1 0" visible="false">
        <a-plane width="1.5" height="1" color="black" opacity="0.8"></a-plane>
        <a-text value="Title: The Journey\nArtist: Kwame Asante\nMeaning: A story of resilience and culture."
                position="0 0 0.1" align="center" color="white" width="1.3"></a-text>
        
        <!-- Close Button -->
        <a-plane id="close-btn-1" class="clickable"
                 position="0 -0.5 0.1" width="0.5" height="0.2"
                 material="src: https://cdn.glitch.global/9b643d33-8eab-444c-bfc4-185db20906b5/close%20button.png?v=1740476714869">
        </a-plane>
      </a-entity>

    </a-entity>

  </a-scene>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adinkra Alive | Immersive AR Experience</title>
    <style>
        :root {
            --primary: #D4AF37;
            --secondary: #008751;
            --accent: #CE1126;
            --dark: #222;
            --light: #f5f5f5;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        header {
            background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), 
                        url('https://cdn.glitch.global/efbdd796-2226-4f2d-842a-2b1ca1ca40af/adinkra-cover.png?v=1743643462685') center/cover no-repeat;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .logo img {
            width: 50px;
            height: 50px;
            margin-right: 10px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .tagline {
            font-style: italic;
            margin-bottom: 20px;
        }
        
        .flag-colors {
            display: flex;
            width: 150px;
            margin: 20px auto 0;
        }
        
        .flag-color {
            height: 5px;
            flex: 1;
        }
        
        .red { background-color: #CE1126; }
        .gold { background-color: #FCD116; }
        .green { background-color: #008751; }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 30px;
        }
        
        .camera-container {
            width: 100%;
            min-height: 60vh;
            position: relative;
        }
        
        .info-container {
            width: 100%;
        }
        
        .video-container {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            min-height: 60vh;
            background-color: #000;
        }
        
        #camera, #canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .control-button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: bold;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        
        .control-button:hover {
            background-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .top-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 10;
            display: flex;
            gap: 10px;
        }
        
        .bottom-controls {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            display: flex;
            gap: 15px;
            justify-content: center;
            width: 90%;
        }
        
        .floating-button {
            background-color: rgba(0, 135, 81, 0.8);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: var(--transition);
        }
        
        .floating-button:hover {
            background-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .floating-button i {
            font-size: 20px;
        }
        
        .capture-button {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background-color: var(--accent);
            border: 4px solid white;
        }
        
        #symbol-info {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
            transition: all 0.5s ease;
            margin-top: 20px;
        }
        
        .symbol {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .symbol:last-child {
            border-bottom: none;
        }
        
        .symbol-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .symbol-icon {
            width: 40px;
            height: 40px;
            background-color: var(--primary);
            border-radius: 50%;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .confidence-bar {
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .confidence-level {
            height: 100%;
            background-color: var(--accent);
            transition: width 0.5s ease;
        }
        
        .instructions {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .instructions h2 {
            color: var(--secondary);
            margin-bottom: 15px;
        }
        
        .step {
            display: flex;
            margin-bottom: 15px;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            background-color: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .loader {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 20;
        }
        
        .loader-circle {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .symbol-library {
            margin-top: 40px;
        }
        
        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .library-item {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .library-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        
        .library-img {
            width: 60px;
            height: 60px;
            margin: 0 auto 10px;
            background-color: #eee;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        footer {
            background-color: var(--dark);
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 50px;
        }
        
        .back-to-home {
            display: inline-block;
            margin-top: 20px;
            color: var(--primary);
            text-decoration: none;
            font-weight: bold;
        }
        
        /* AR Elements */
        .ar-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }
        
        .ar-element {
            position: absolute;
            pointer-events: all;
            user-select: none;
            transition: transform 0.2s ease, opacity 0.3s ease;
        }
        
        .ar-symbol {
            position: absolute;
            transform-style: preserve-3d;
            transition: all 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .ar-symbol svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.7));
        }
        
        .ar-highlight {
            position: absolute;
            border: 2px solid var(--primary);
            border-radius: 5px;
            box-shadow: 0 0 0 rgba(212, 175, 55, 0.7);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(212, 175, 55, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(212, 175, 55, 0);
            }
        }
        
        .ar-info-card {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            width: 250px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: all;
            z-index: 10;
        }
        
        .ar-info-card.active {
            transform: translateY(0);
            opacity: 1;
        }
        
        .ar-info-card h3 {
            margin-top: 0;
            color: var(--secondary);
            font-size: 1.2rem;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .ar-info-card p {
            margin: 8px 0;
            font-size: 0.9rem;
        }
        
        .ar-tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            pointer-events: none;
            transform: translateY(-30px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .hint-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
            z-index: 30;
        }
        
        .hint-content {
            text-align: center;
            padding: 20px;
        }
        
        .ar-mode-active .video-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 100;
            border-radius: 0;
        }
        
        .ar-mode-active .controls,
        .ar-mode-active .additional-controls {
            position: fixed;
            z-index: 101;
        }
        
        .ar-mode-active .loader {
            z-index: 102;
        }
        
        .ar-mode-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 50;
            background-color: var(--accent);
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .symbol-3d {
            width: 100px;
            height: 100px;
            position: absolute;
            transform-style: preserve-3d;
            animation: rotate3d 8s infinite linear;
        }
        
        @keyframes rotate3d {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        
        .particle {
            position: absolute;
            background-color: var(--primary);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.7;
            z-index: 4;
        }
        
        .settings-panel {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background-color: white;
            z-index: 200;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            padding: 20px;
            overflow-y: auto;
        }
        
        .settings-panel.active {
            right: 0;
        }
        
        .settings-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .settings-section {
            margin-bottom: 20px;
        }
        
        .settings-section h3 {
            color: var(--secondary);
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        
        .settings-option {
            margin-bottom: 10px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 10px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--secondary);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .library-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 15px;
            }
            
            .bottom-controls {
                width: 100%;
            }
        }
        
        @media (min-width: 768px) {
            .app-container {
                flex-direction: row;
            }
            
            .camera-container {
                flex: 3;
            }
            
            .info-container {
                flex: 2;
            }
        }
        
        /* Onboarding */
        .onboarding-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0,0,0,0.8);
            z-index: 300;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }
        
        .onboarding-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .onboarding-card {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 90%;
            width: 500px;
            text-align: center;
        }
        
        .onboarding-image {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
            border-radius: 10px;
        }
        
        .onboarding-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .onboarding-dots {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .onboarding-dot {
            width: 10px;
            height: 10px;
            background-color: #ccc;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }
        
        .onboarding-dot.active {
            background-color: var(--secondary);
        }
    </style>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Three.js for 3D rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <header>
        <div class="logo">
            <img src="" alt="Logo">
            <h1>Adinkra Alive</h1>
        </div>
        <p class="tagline">Experience Ghana's Ancient Symbols in Augmented Reality</p>
        <div class="flag-colors">
            <div class="flag-color red"></div>
            <div class="flag-color gold"></div>
            <div class="flag-color green"></div>
        </div>
    </header>
    
    <div class="container">
        <div class="app-container">
            <div class="camera-container">
                <div class="video-container">
                    <video id="camera" autoplay playsinline></video>
                    <canvas id="canvas"></canvas>
                    <div class="ar-overlay" id="ar-overlay"></div>
                    
                    <div class="top-controls">
                        <button class="floating-button" id="settings-btn" title="Settings">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button class="floating-button" id="switch-camera" title="Switch Camera">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    
                    <div class="bottom-controls">
                        <button class="floating-button" id="toggle-flash" title="Toggle Flash">
                            <i class="fas fa-bolt"></i>
                        </button>
                        <button class="floating-button capture-button" id="capture-btn" title="Capture">
                            <i class="fas fa-camera"></i>
                        </button>
                        <button class="floating-button" id="fullscreen-btn" title="Fullscreen">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                    
                    <div class="loader" id="loader">
                        <div class="loader-circle"></div>
                    </div>
                    
                    <div class="hint-overlay" id="hint-overlay">
                        <div class="hint-content">
                            <h3>Move closer to the symbol</h3>
                            <p>Make sure the symbol is well lit and centered</p>
                        </div>
                    </div>
                </div>
                
                <div class="additional-controls">
                    <select id="quality-selector" class="control-button" onchange="changeDetectionQuality(this.value)">
                        <option value="low">Low Quality (Faster)</option>
                        <option value="medium" selected>Medium Quality</option>
                        <option value="high">High Quality (Slower)</option>
                    </select>
                    
                    <select id="effect-selector" class="control-button" onchange="changeAREffect(this.value)">
                        <option value="basic">Basic Highlight</option>
                        <option value="3d" selected>3D Models</option>
                        <option value="particles">Particle Effects</option>
                    </select>
                </div>
            </div>
            
            <div class="info-container">
                <div id="symbol-info">
                    <h2>Detected Symbols</h2>
                    <p>Point your camera at an Adinkra symbol to experience it in AR.</p>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h2>How to Use Adinkra Alive AR</h2>
            <div class="step">
                <div class="step-number">1</div>
                <div>Allow camera access when prompted.</div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div>Point your camera at any Adinkra symbol - on fabric, in books, or printed images.</div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div>Hold steady while the AR experience loads. You'll see the symbol come alive with animations.</div>
            </div>
            <div class="step">
                <div class="step-number">4</div>
                <div>Interact with the AR symbols - tap to see information, use pinch gestures to resize, and explore in 3D.</div>
            </div>
        </div>
        
        <div class="symbol-library">
            <h2>Adinkra Symbol Library</h2>
            <p>Can't find a symbol to scan? Explore our digital library of Adinkra symbols below:</p>
            <div class="library-grid" id="symbol-library">
                <!-- Symbol library items will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <button class="ar-mode-toggle" id="ar-mode-toggle">
        <i class="fas fa-vr-cardboard"></i>
    </button>
    
    <div class="settings-panel" id="settings-panel">
        <button class="settings-close" id="settings-close">×</button>
        <h2>AR Settings</h2>
        
        <div class="settings-section">
            <h3>Display</h3>
            <div class="settings-option">
                <label>Show 3D Models</label>
                <label class="switch">
                    <input type="checkbox" id="setting-3d-models" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label>Show Information Cards</label>
                <label class="switch">
                    <input type="checkbox" id="setting-info-cards" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label>Particle Effects</label>
                <label class="switch">
                    <input type="checkbox" id="setting-particles">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <div class="settings-section">
            <h3>Detection</h3>
            <div class="settings-option">
                <label>Continuous Detection</label>
                <label class="switch">
                    <input type="checkbox" id="setting-continuous" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label>Detection Interval (ms)</label>
                <input type="range" min="500" max="5000" step="500" value="2000" id="setting-interval">
                <span id="interval-value">2000</span>
            </div>
        </div>
        
        <div class="settings-section">
            <h3>Haptics & Sound</h3>
            <div class="settings-option">
                <label>Vibration Feedback</label>
                <label class="switch">
                    <input type="checkbox" id="setting-vibration" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label>Sound Effects</label>
                <label class="switch">
                    <input type="checkbox" id="setting-sound">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>
    
    <div class="onboarding-overlay" id="onboarding-overlay">
        <div class="onboarding-card">
            <div class="onboarding-image">
                <i class="fas fa-camera" style="font-size: 50px; color: var(--secondary);"></i>
            </div>
            <h2>Welcome to Adinkra Alive AR</h2>
            <p>Experience Ghana's ancient symbols in immersive augmented reality.</p>
            <div class="onboarding-navigation">
                <button class="control-button" id="onboarding-skip">Skip</button>
                <button class="control-button" id="onboarding-next">Next</button>
            </div>
            <div class="onboarding-dots">
                <div class="onboarding-dot active"></div>
                <div class="onboarding-dot"></div>
                <div class="onboarding-dot"></div>
                <div class="onboarding-dot"></div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>&copy; 2025 ARIA Ghana | Adinkra Alive Experience</p>
        <a href="index.html" class="back-to-home">Back to ARIA Ghana Home</a>
    </footer>

    <script>
        // Roboflow API Config (replace with your model's API key)
        const API_KEY = "F18HnIZIkIzPqw8LQYRJ";
        const MODEL_ENDPOINT = "adinkra-symbols/3"; // From your model URL

        // Expanded Adinkra symbol database with more symbols and richer information
        const ADINKRA_DB = {
            "Gye Nyame": { 
                meaning: "Except for God", 
                origin: "Akan (Ghana)", 
                description: "Represents the omnipotence and supremacy of God. This symbol expresses the deep faith and acknowledgment that only God can fully comprehend the beginning and end of all things.",
                usage: "Often used in ceremonies that mark significant life transitions, and commonly found on traditional cloth, architectural elements, and jewelry."
            },
            "Eban": {
                meaning: "Fence",
                origin: "Akan (Ghana)",
                description: "Symbol of safety, security, and protection. It reflects the importance of home and family as a safe haven.",
                usage: "Often found on household items, doorways, and protective amulets to ensure security and ward off negative forces."
            },
            "Duafe": {
                meaning: "Wooden comb",
                origin: "Akan (Ghana)",
                description: "Symbol of cleanliness, good grooming, love, and feminine virtues. It represents care and nurturing.",
                usage: "Frequently used in contexts celebrating womanhood, beauty, and in ceremonies marking transitions in a woman's life."
            },
            "Fawohodie": {
                meaning: "Independence",
                origin: "Akan (Ghana)",
                description: "Symbol of emancipation, freedom, and liberty. It celebrates the struggle for freedom and justice.",
                usage: "Often seen in political contexts, on commemorative items, and during independence celebrations."
            },
            "Sankofa": {
                meaning: "Return and get it",
                origin: "Akan (Ghana)",
                description: "Symbol representing the importance of learning from the past. It teaches that we should reach back and gather the best of what our past has to teach us so that we can achieve our full potential as we move forward.",
                usage: "Commonly used in educational settings, historical commemorations, and as a reminder of cultural heritage."
            },
            "Dwennimmen": {
                meaning: "Ram's horns",
                origin: "Akan (Ghana)",
                description: "Symbol of humility and strength. The ram will fight fiercely, but it also submits humbly to slaughter, emphasizing that even the strong need to be humble.",
                usage: "Used to promote values of humility alongside strength, often in contexts where leadership qualities are celebrated."
            },
            "Akoma": {
                meaning: "Heart",
                origin: "Akan (Ghana)",
                description: "Symbol of patience and tolerance. It represents understanding and agreement in difficult deliberations.",
                usage: "Often used in contexts of reconciliation, peace-making, and on items given as gifts of friendship and love."
            },
            "Aya": {
                meaning: "Fern",
                origin: "Akan (Ghana)",
                description: "Symbol of endurance and resourcefulness. The fern is a hardy plant that can grow in difficult places, representing perseverance and adaptability.",
                usage: "Used to encourage perseverance through hardship and as a symbol of resilience in challenging times."
            }
        };

        // DOM elements
        const video = document.getElementById("camera");
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        const infoDiv = document.getElementById("symbol-info");
        const captureBtn = document.getElementById("capture-btn");
        const switchCameraBtn = document.getElementById("switch-camera");
        const fullscreenBtn = document.getElementById("fullscreen-btn");
        const loader = document.getElementById("loader");
        const libraryContainer = document.getElementById("symbol-library");
  
        let lastDetectedSymbols = [];
        let isInfoLocked = false;
        let detectionQuality = "medium";
        let currentStream;
        let facingMode = "environment"; // Start with back camera
        let detectionInterval;
        let processingImage = false;

        // Set canvas dimensions
        function setCanvasDimensions() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
        }

        // Start camera
        async function startCamera() {
            try {
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                }
              
                // Resolution based on quality setting
                let resolution = { width: 640, height: 480 }; // medium quality default
                if (detectionQuality === "low") {
                    resolution = { width: 320, height: 240 };
                } else if (detectionQuality === "high") {
                    resolution = { width: 1280, height: 720 };
                }
                
                const constraints = { 
                    video: { 
                        facingMode: facingMode,
                        width: { ideal: resolution.width },
                        height: { ideal: resolution.height }
                    } 
                };
                
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                currentStream = stream;
                
                video.onloadedmetadata = () => {
                    setCanvasDimensions();
                    //Use button click for detection instead of interval
                    if (detectionInterval) clearInterval(detectionInterval);
                    // // Optional: You can still keep a slower background detection
                    // detectionInterval = setInterval(detectSymbols, 10000); // Process frames every 10 seconds
                };
            } catch (err) {
                console.error("Camera error:", err);
                infoDiv.innerHTML = `
                    <h2>Camera Error</h2>
                    <p>Could not access the camera. Please ensure you've granted permission and that your device has a working camera.</p>
                    <p>Error: ${err.message}</p>
                `;
            }
        }

        // Detect symbols using Roboflow API
        async function detectSymbols() {
            if (processingImage) return;
            
            try {
                processingImage = true;
                loader.style.display = "block";
                
                // Draw current video frame to canvas
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                const imageData = canvas.toDataURL("image/jpeg");
                
                // Call Roboflow API
                const formData = new FormData();
                formData.append("file", dataURItoBlob(imageData));
                
                const response = await fetch(
                    `https://detect.roboflow.com/${MODEL_ENDPOINT}?api_key=${API_KEY}`,
                    {
                        method: "POST",
                        body: formData,
                    }
                );
                
                const predictions = await response.json();
                
                // Display results
                displayDetections(predictions);
            } catch (err) {
                console.error("Detection error:", err);
                infoDiv.innerHTML = `
                    <h2>Detection Error</h2>
                    <p>An error occurred while trying to detect symbols.</p>
                    <p>Error: ${err.message}</p>
                `;
            } finally {
                processingImage = false;
                loader.style.display = "none";
            }
        }

        // Convert data URI to Blob
        function dataURItoBlob(dataURI) {
            const byteString = atob(dataURI.split(',')[1]);
            const mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
            const ab = new ArrayBuffer(byteString.length);
            const ia = new Uint8Array(ab);
            
            for (let i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            
            return new Blob([ab], {type: mimeString});
        }

        // Draw bounding boxes + show symbol info
        function displayDetections(predictions) {
          
            if (isInfoLocked) return;
          
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            let infoHTML = `
                <div class="info-header">
                    <h2>Detected Symbols</h2>
                    <button id="lock-info" onclick="toggleInfoLock()">
                        ${isInfoLocked ? 'Unlock' : 'Lock'} Info
                    </button>
                </div>
            `;
            
            if (predictions.predictions && predictions.predictions.length > 0) {
                  // Store the last valid predictions
                  lastDetectedSymbols = predictions.predictions;

                  // Process and display as before
                  lastDetectedSymbols.forEach(prediction => {
                    const x = prediction.x - prediction.width / 2;
                    const y = prediction.y - prediction.height / 2;
                    
                    // Draw bounding box with glow effect
                    ctx.strokeStyle = "#FCD116"; // Gold color
                    ctx.lineWidth = 4;
                    ctx.strokeRect(x, y, prediction.width, prediction.height);
                    
                    // Draw label background
                    ctx.fillStyle = "rgba(0, 135, 81, 0.8)"; // Semi-transparent green
                    const textWidth = ctx.measureText(`${prediction.class}`).width;
                    ctx.fillRect(x, y - 30, textWidth + 20, 30);
                    
                    // Draw label
                    ctx.fillStyle = "white";
                    ctx.font = "bold 16px Arial";
                    ctx.fillText(
                        `${prediction.class}`,
                        x + 10,
                        y - 10
                    );
                    
                    // Add symbol info with enhanced styling
                    if (ADINKRA_DB[prediction.class]) {
                        const symbol = ADINKRA_DB[prediction.class];
                        const confidence = Math.round(prediction.confidence * 100);
                        
                        infoHTML += `
                            <div class="symbol">
                                <div class="symbol-header">
                                    <div class="symbol-icon">${prediction.class.charAt(0)}</div>
                                    <h3>${prediction.class}</h3>
                                </div>
                                <div class="confidence-bar">
                                    <div class="confidence-level" style="width: ${confidence}%"></div>
                                </div>
                                <p><small>Confidence: ${confidence}%</small></p>
                                <p><strong>Meaning:</strong> ${symbol.meaning}</p>
                                <p><strong>Origin:</strong> ${symbol.origin}</p>
                                <p>${symbol.description}</p>
                                <p><strong>Traditional Usage:</strong> ${symbol.usage}</p>
                            </div>
                        `;
                    }
                });
              } else if (lastDetectedSymbols.length > 0) {
                  // Still show the last detected symbols but with a notice
                  infoHTML += `<p class="notice">Showing last detected symbols. Move camera to detect new symbols.</p>`;
        
            } else {
                infoHTML = `
                    <h2>No Symbols Detected</h2>
                    <p>Try one of these tips:</p>
                    <ul>
                        <li>Move closer to the symbol</li>
                        <li>Ensure there is good lighting</li>
                        <li>Hold your device steady</li>
                        <li>Try using the "Capture Frame" button</li>
                    </ul>
                    <p>Or explore our symbol library below to learn about Adinkra symbols.</p>
                `;
            }

            infoDiv.innerHTML = infoHTML;
        }

        // Switch between front and back camera
        function toggleCamera() {
            facingMode = facingMode === "user" ? "environment" : "user";
            startCamera();
        }

        // Enter fullscreen mode
        function enterFullscreen() {
            const videoContainer = document.querySelector('.video-container');
            if (videoContainer.requestFullscreen) {
                videoContainer.requestFullscreen();
            } else if (videoContainer.webkitRequestFullscreen) {
                videoContainer.webkitRequestFullscreen();
            } else if (videoContainer.msRequestFullscreen) {
                videoContainer.msRequestFullscreen();
            }
        }

        // Populate symbol library
        function populateSymbolLibrary() {
            let html = '';
            
            for (const symbol in ADINKRA_DB) {
                html += `
                    <div class="library-item" onclick="showSymbolInfo('${symbol}')">
                        <div class="library-img">${symbol.charAt(0)}</div>
                        <h4>${symbol}</h4>
                    </div>
                `;
            }
            
            libraryContainer.innerHTML = html;
        }

        // Show info for a symbol from the library
        function showSymbolInfo(symbolName) {
            if (ADINKRA_DB[symbolName]) {
                const symbol = ADINKRA_DB[symbolName];
                
                infoDiv.innerHTML = `
                    <div class="symbol">
                        <div class="symbol-header">
                            <div class="symbol-icon">${symbolName.charAt(0)}</div>
                            <h3>${symbolName}</h3>
                        </div>
                        <p><strong>Meaning:</strong> ${symbol.meaning}</p>
                        <p><strong>Origin:</strong> ${symbol.origin}</p>
                        <p>${symbol.description}</p>
                        <p><strong>Traditional Usage:</strong> ${symbol.usage}</p>
                    </div>
                    <p><small>From library selection</small></p>
                `;
                
                // Scroll to info container for mobile users
                infoDiv.scrollIntoView({ behavior: 'smooth' });
            }
        }
      
      
        // this function is to toggle info locking
        function toggleInfoLock() {
            isInfoLocked = !isInfoLocked;
            document.getElementById('lock-info').textContent = isInfoLocked ? 'Unlock Info' : 'Lock Info';
        }

        // A quality toggle function
        function changeDetectionQuality(quality) {
            detectionQuality = quality; // "low", "medium", or "high"
            startCamera(); // Restart camera with new settings
        }


        // Event listeners
        captureBtn.addEventListener('click', detectSymbols);
        switchCameraBtn.addEventListener('click', toggleCamera);
        fullscreenBtn.addEventListener('click', enterFullscreen);
        
        // Make showSymbolInfo available to onclick handlers
        window.showSymbolInfo = showSymbolInfo;
        window.toggleInfoLock = toggleInfoLock;
        window.changeDetectionQuality = changeDetectionQuality;

        // Initialize
        startCamera();
        populateSymbolLibrary();
    </script>
</body>
</html>
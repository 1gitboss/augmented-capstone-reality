<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adinkra Alive | Immersive AR Experience</title>
    <style>
        :root {
            --primary: #D4AF37;
            --secondary: #008751;
            --accent: #CE1126;
            --dark: #222;
            --light: #f5f5f5;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        header {
            background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), 
                        url('https://cdn.glitch.global/efbdd796-2226-4f2d-842a-2b1ca1ca40af/adinkra-cover.png?v=1743643462685') center/cover no-repeat;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .logo img {
            width: 50px;
            height: 50px;
            margin-right: 10px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .tagline {
            font-style: italic;
            margin-bottom: 20px;
        }
        
        .flag-colors {
            display: flex;
            width: 150px;
            margin: 20px auto 0;
        }
        
        .flag-color {
            height: 5px;
            flex: 1;
        }
        
        .red { background-color: #CE1126; }
        .gold { background-color: #FCD116; }
        .green { background-color: #008751; }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 30px;
        }
        
        .camera-container {
            width: 100%;
            min-height: 60vh;
            position: relative;
        }
        
        .info-container {
            width: 100%;
        }
        
        .video-container {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            min-height: 60vh;
            background-color: #000;
        }
        
        #camera, #canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .control-button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: bold;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        
        .control-button:hover {
            background-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .top-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 10;
            display: flex;
            gap: 10px;
        }
        
        .bottom-controls {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            display: flex;
            gap: 15px;
            justify-content: center;
            width: 90%;
        }
        
        .floating-button {
            background-color: rgba(0, 135, 81, 0.8);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: var(--transition);
        }
        
        .floating-button:hover {
            background-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .floating-button i {
            font-size: 20px;
        }
        
        .capture-button {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background-color: var(--accent);
            border: 4px solid white;
        }
        
        #symbol-info {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
            transition: all 0.5s ease;
            margin-top: 20px;
        }
        
        .symbol {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .symbol:last-child {
            border-bottom: none;
        }
        
        .symbol-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .symbol-icon {
            width: 40px;
            height: 40px;
            background-color: var(--primary);
            border-radius: 50%;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .confidence-bar {
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .confidence-level {
            height: 100%;
            background-color: var(--accent);
            transition: width 0.5s ease;
        }
        
        .instructions {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .instructions h2 {
            color: var(--secondary);
            margin-bottom: 15px;
        }
        
        .step {
            display: flex;
            margin-bottom: 15px;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            background-color: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .loader {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 20;
        }
        
        .loader-circle {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .symbol-library {
            margin-top: 40px;
        }
        
        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .library-item {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .library-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        
        .library-img {
            width: 60px;
            height: 60px;
            margin: 0 auto 10px;
            background-color: #eee;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        footer {
            background-color: var(--dark);
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 50px;
        }
        
        .back-to-home {
            display: inline-block;
            margin-top: 20px;
            color: var(--primary);
            text-decoration: none;
            font-weight: bold;
        }
        
        /* AR Elements */
        .ar-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }
        
        .ar-element {
            position: absolute;
            pointer-events: all;
            user-select: none;
            transition: transform 0.2s ease, opacity 0.3s ease;
        }
        
        .ar-symbol {
            position: absolute;
            transform-style: preserve-3d;
            transition: all 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .ar-symbol svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.7));
        }
        
        .ar-highlight {
            position: absolute;
            border: 2px solid var(--primary);
            border-radius: 5px;
            box-shadow: 0 0 0 rgba(212, 175, 55, 0.7);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(212, 175, 55, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(212, 175, 55, 0);
            }
        }
        
        .ar-info-card {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            width: 250px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: all;
            z-index: 10;
        }
        
        .ar-info-card.active {
            transform: translateY(0);
            opacity: 1;
        }
        
        .ar-info-card h3 {
            margin-top: 0;
            color: var(--secondary);
            font-size: 1.2rem;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .ar-info-card p {
            margin: 8px 0;
            font-size: 0.9rem;
        }
        
        .ar-tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            pointer-events: none;
            transform: translateY(-30px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .hint-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
            z-index: 30;
        }
        
        .hint-content {
            text-align: center;
            padding: 20px;
        }
        
        .ar-mode-active .video-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 100;
            border-radius: 0;
        }
        
        .ar-mode-active .controls,
        .ar-mode-active .additional-controls {
            position: fixed;
            z-index: 101;
        }
        
        .ar-mode-active .loader {
            z-index: 102;
        }
        
        .ar-mode-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 50;
            background-color: var(--accent);
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .symbol-3d {
            width: 100px;
            height: 100px;
            position: absolute;
            transform-style: preserve-3d;
            animation: rotate3d 8s infinite linear;
        }
        
        @keyframes rotate3d {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        
        .particle {
            position: absolute;
            background-color: var(--primary);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.7;
            z-index: 4;
        }
        
        .settings-panel {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background-color: white;
            z-index: 200;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            padding: 20px;
            overflow-y: auto;
        }
        
        .settings-panel.active {
            right: 0;
        }
        
        .settings-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .settings-section {
            margin-bottom: 20px;
        }
        
        .settings-section h3 {
            color: var(--secondary);
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        
        .settings-option {
            margin-bottom: 10px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 10px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--secondary);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .library-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 15px;
            }
            
            .bottom-controls {
                width: 100%;
            }
        }
        
        @media (min-width: 768px) {
            .app-container {
                flex-direction: row;
            }
            
            .camera-container {
                flex: 3;
            }
            
            .info-container {
                flex: 2;
            }
        }
        
        /* Onboarding */
        .onboarding-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0,0,0,0.8);
            z-index: 300;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }
        
        .onboarding-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .onboarding-card {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 90%;
            width: 500px;
            text-align: center;
        }
        
        .onboarding-image {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
            border-radius: 10px;
        }
        
        .onboarding-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .onboarding-dots {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .onboarding-dot {
            width: 10px;
            height: 10px;
            background-color: #ccc;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }
        
        .onboarding-dot.active {
            background-color: var(--secondary);
        }
    </style>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Three.js for 3D rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <header>
        <div class="logo">
            <img src="" alt="Logo">
            <h1>Adinkra Alive</h1>
        </div>
        <p class="tagline">Experience Ghana's Ancient Symbols in Augmented Reality</p>
        <div class="flag-colors">
            <div class="flag-color red"></div>
            <div class="flag-color gold"></div>
            <div class="flag-color green"></div>
        </div>
    </header>
    
    <div class="container">
        <div class="app-container">
            <div class="camera-container">
                <div class="video-container">
                    <video id="camera" autoplay playsinline></video>
                    <canvas id="canvas"></canvas>
                    <div class="ar-overlay" id="ar-overlay"></div>
                    
                    <div class="top-controls">
                        <button class="floating-button" id="settings-btn" title="Settings">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button class="floating-button" id="switch-camera" title="Switch Camera">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    
                    <div class="bottom-controls">
                        <button class="floating-button" id="toggle-flash" title="Toggle Flash">
                            <i class="fas fa-bolt"></i>
                        </button>
                        <button class="floating-button capture-button" id="capture-btn" title="Capture">
                            <i class="fas fa-camera"></i>
                        </button>
                        <button class="floating-button" id="fullscreen-btn" title="Fullscreen">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                    
                    <div class="loader" id="loader">
                        <div class="loader-circle"></div>
                    </div>
                    
                    <div class="hint-overlay" id="hint-overlay">
                        <div class="hint-content">
                            <h3>Move closer to the symbol</h3>
                            <p>Make sure the symbol is well lit and centered</p>
                        </div>
                    </div>
                </div>
                
                <div class="additional-controls">
                    <select id="quality-selector" class="control-button" onchange="changeDetectionQuality(this.value)">
                        <option value="low">Low Quality (Faster)</option>
                        <option value="medium" selected>Medium Quality</option>
                        <option value="high">High Quality (Slower)</option>
                    </select>
                    
                    <select id="effect-selector" class="control-button" onchange="changeAREffect(this.value)">
                        <option value="basic">Basic Highlight</option>
                        <option value="3d" selected>3D Models</option>
                        <option value="particles">Particle Effects</option>
                    </select>
                </div>
            </div>
            
            <div class="info-container">
                <div id="symbol-info">
                    <h2>Detected Symbols</h2>
                    <p>Point your camera at an Adinkra symbol to experience it in AR.</p>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h2>How to Use Adinkra Alive AR</h2>
            <div class="step">
                <div class="step-number">1</div>
                <div>Allow camera access when prompted.</div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div>Point your camera at any Adinkra symbol - on fabric, in books, or printed images.</div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div>Hold steady while the AR experience loads. You'll see the symbol come alive with animations.</div>
            </div>
            <div class="step">
                <div class="step-number">4</div>
                <div>Interact with the AR symbols - tap to see information, use pinch gestures to resize, and explore in 3D.</div>
            </div>
        </div>
        
        <div class="symbol-library">
            <h2>Adinkra Symbol Library</h2>
            <p>Can't find a symbol to scan? Explore our digital library of Adinkra symbols below:</p>
            <div class="library-grid" id="symbol-library">
                <!-- Symbol library items will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <button class="ar-mode-toggle" id="ar-mode-toggle">
        <i class="fas fa-vr-cardboard"></i>
    </button>
    
    <div class="settings-panel" id="settings-panel">
        <button class="settings-close" id="settings-close">×</button>
        <h2>AR Settings</h2>
        
        <div class="settings-section">
            <h3>Display</h3>
            <div class="settings-option">
                <label>Show 3D Models</label>
                <label class="switch">
                    <input type="checkbox" id="setting-3d-models" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label>Show Information Cards</label>
                <label class="switch">
                    <input type="checkbox" id="setting-info-cards" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label>Particle Effects</label>
                <label class="switch">
                    <input type="checkbox" id="setting-particles">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <div class="settings-section">
            <h3>Detection</h3>
            <div class="settings-option">
                <label>Continuous Detection</label>
                <label class="switch">
                    <input type="checkbox" id="setting-continuous" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label>Detection Interval (ms)</label>
                <input type="range" min="500" max="5000" step="500" value="2000" id="setting-interval">
                <span id="interval-value">2000</span>
            </div>
        </div>
        
        <div class="settings-section">
            <h3>Haptics & Sound</h3>
            <div class="settings-option">
                <label>Vibration Feedback</label>
                <label class="switch">
                    <input type="checkbox" id="setting-vibration" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label>Sound Effects</label>
                <label class="switch">
                    <input type="checkbox" id="setting-sound">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>
    
    <div class="onboarding-overlay" id="onboarding-overlay">
        <div class="onboarding-card">
            <div class="onboarding-image">
                <i class="fas fa-camera" style="font-size: 50px; color: var(--secondary);"></i>
            </div>
            <h2>Welcome to Adinkra Alive AR</h2>
            <p>Experience Ghana's ancient symbols in immersive augmented reality.</p>
            <div class="onboarding-navigation">
                <button class="control-button" id="onboarding-skip">Skip</button>
                <button class="control-button" id="onboarding-next">Next</button>
            </div>
            <div class="onboarding-dots">
                <div class="onboarding-dot active"></div>
                <div class="onboarding-dot"></div>
                <div class="onboarding-dot"></div>
                <div class="onboarding-dot"></div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>&copy; 2025 ARIA Ghana | Adinkra Alive Experience</p>
        <a href="index.html" class="back-to-home">Back to ARIA Ghana Home</a>
    </footer>

    <script>
        // Roboflow API Config (replace with your model's API key)
        const API_KEY = "F18HnIZIkIzPqw8LQYRJ";
        const MODEL_ENDPOINT = "adinkra-symbols/3"; // From your model URL

        // Expanded Adinkra symbol database with more symbols and richer information
        const ADINKRA_DB = {
            "Gye Nyame": { 
                meaning: "Except for God", 
                origin: "Akan (Ghana)", 
                description: "Represents the omnipotence and supremacy of God. This symbol expresses the deep faith and acknowledgment that only God can fully comprehend the beginning and end of all things.",
                usage: "Often used in ceremonies that mark significant life transitions, and commonly found on traditional cloth, architectural elements, and jewelry."
            },
            "Eban": {
                meaning: "Fence",
                origin: "Akan (Ghana)",
                description: "Symbol of safety, security, and protection. It reflects the importance of home and family as a safe haven.",
                usage: "Often found on household items, doorways, and protective amulets to ensure security and ward off negative forces."
            },
            "Duafe": {
                meaning: "Wooden comb",
                origin: "Akan (Ghana)",
                description: "Symbol of cleanliness, good grooming, love, and feminine virtues. It represents care and nurturing.",
                usage: "Frequently used in contexts celebrating womanhood, beauty, and in ceremonies marking transitions in a woman's life."
            },
            "Fawohodie": {
                meaning: "Independence",
                origin: "Akan (Ghana)",
                description: "Symbol of emancipation, freedom, and liberty. It celebrates the struggle for freedom and justice.",
                usage: "Often seen in political contexts, on commemorative items, and during independence celebrations."
            },
            "Sankofa": {
                meaning: "Return and get it",
                origin: "Akan (Ghana)",
                description: "Symbol representing the importance of learning from the past. It teaches that we should reach back and gather the best of what our past has to teach us so that we can achieve our full potential as we move forward.",
                usage: "Commonly used in educational settings, historical commemorations, and as a reminder of cultural heritage."
            },
            "Dwennimmen": {
                meaning: "Ram's horns",
                origin: "Akan (Ghana)",
                description: "Symbol of humility and strength. The ram will fight fiercely, but it also submits humbly to slaughter, emphasizing that even the strong need to be humble.",
                usage: "Used to promote values of humility alongside strength, often in contexts where leadership qualities are celebrated."
            },
            "Akoma": {
                meaning: "Heart",
                origin: "Akan (Ghana)",
                description: "Symbol of patience and tolerance. It represents understanding and agreement in difficult deliberations.",
                usage: "Often used in contexts of reconciliation, peace-making, and on items given as gifts of friendship and love."
            },
            "Aya": {
                meaning: "Fern",
                origin: "Akan (Ghana)",
                description: "Symbol of endurance and resourcefulness. The fern is a hardy plant that can grow in difficult places, representing perseverance and adaptability.",
                usage: "Used to encourage perseverance through hardship and as a symbol of resilience in challenging times."
            }
        };
document.addEventListener('DOMContentLoaded', function() {
        // DOM elements
        const camera = document.getElementById('camera');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const arOverlay = document.getElementById('ar-overlay');
    const symbolInfo = document.getElementById('symbol-info');
    const loader = document.getElementById('loader');
    const hintOverlay = document.getElementById('hint-overlay');
    const symbolLibrary = document.getElementById('symbol-library');
    
    // Button elements
    const captureBtn = document.getElementById('capture-btn');
    const switchCameraBtn = document.getElementById('switch-camera');
    const toggleFlashBtn = document.getElementById('toggle-flash');
    const fullscreenBtn = document.getElementById('fullscreen-btn');
    const settingsBtn = document.getElementById('settings-btn');
    const settingsPanel = document.getElementById('settings-panel');
    const settingsClose = document.getElementById('settings-close');
    const arModeToggle = document.getElementById('ar-mode-toggle');
    
    // Onboarding elements
    const onboardingOverlay = document.getElementById('onboarding-overlay');
    const onboardingSkip = document.getElementById('onboarding-skip');
    const onboardingNext = document.getElementById('onboarding-next');
    const onboardingDots = document.querySelectorAll('.onboarding-dot');
    
    // Settings elements
    const setting3dModels = document.getElementById('setting-3d-models');
    const settingInfoCards = document.getElementById('setting-info-cards');
    const settingParticles = document.getElementById('setting-particles');
    const settingContinuous = document.getElementById('setting-continuous');
    const settingInterval = document.getElementById('setting-interval');
    const intervalValue = document.getElementById('interval-value');
    const settingVibration = document.getElementById('setting-vibration');
    const settingSound = document.getElementById('setting-sound');
    
    // App state
    let currentStream = null;
    let facingMode = 'environment'; // Start with back camera
    let flashEnabled = false;
    let isProcessing = false;
    let detectionInterval = 2000; // Default detection interval
    let detectionQuality = 'medium'; // Default detection quality
    let arEffect = '3d'; // Default AR effect
    let detectionTimer = null;
    let currentOnboardingSlide = 0;
    let detectedSymbols = [];
    let threeJsScene = null;
    
    // ===========================================================================
    // Initialization functions
    // ===========================================================================
    
    function initialize() {
        // Initialize camera stream
        initCamera();
        
        // Initialize settings
        initSettings();
        
        // Setup event listeners
        setupEventListeners();
        
        // Initialize Three.js scene for 3D AR effects
        if (setting3dModels.checked) {
            initThreeJsScene();
        }
        
        // Populate symbol library
        populateSymbolLibrary();
        
        // Show onboarding for first-time users
        if (!localStorage.getItem('adinkraAliveOnboardingCompleted')) {
            showOnboarding();
        }
    }
    
    function initCamera() {
        const constraints = {
            video: {
                facingMode: facingMode,
                width: { ideal: 1280 },
                height: { ideal: 720 }
            },
            audio: false
        };
        
        // Stop any existing stream
        if (currentStream) {
            currentStream.getTracks().forEach(track => track.stop());
        }
        
        // Start camera with selected facing mode
        navigator.mediaDevices.getUserMedia(constraints)
            .then(stream => {
                camera.srcObject = stream;
                currentStream = stream;
                
                // Resize canvas to match video dimensions once metadata is loaded
                camera.onloadedmetadata = () => {
                    canvas.width = camera.videoWidth;
                    canvas.height = camera.videoHeight;
                };
                
                // Begin symbol detection after camera is ready
                camera.onplay = () => {
                    startContinuousDetection();
                };
            })
            .catch(err => {
                console.error("Error accessing camera: ", err);
                showError("Camera access denied. Please allow camera access to use AR features.");
            });
    }
    
    function initSettings() {
        // Load settings from local storage if available
        if (localStorage.getItem('adinkraAliveSettings')) {
            const settings = JSON.parse(localStorage.getItem('adinkraAliveSettings'));
            setting3dModels.checked = settings.show3dModels;
            settingInfoCards.checked = settings.showInfoCards;
            settingParticles.checked = settings.showParticles;
            settingContinuous.checked = settings.continuousDetection;
            settingInterval.value = settings.detectionInterval;
            intervalValue.textContent = settings.detectionInterval;
            settingVibration.checked = settings.vibrationFeedback;
            settingSound.checked = settings.soundEffects;
            detectionInterval = settings.detectionInterval;
        }
    }
    
    function setupEventListeners() {
        // Camera control buttons
        captureBtn.addEventListener('click', captureImage);
        switchCameraBtn.addEventListener('click', toggleCamera);
        toggleFlashBtn.addEventListener('click', toggleFlash);
        fullscreenBtn.addEventListener('click', toggleFullscreen);
        
        // Settings panel
        settingsBtn.addEventListener('click', toggleSettingsPanel);
        settingsClose.addEventListener('click', toggleSettingsPanel);
        
        // AR mode toggle
        arModeToggle.addEventListener('click', toggleARMode);
        
        // Settings changes
        setting3dModels.addEventListener('change', updateSettings);
        settingInfoCards.addEventListener('change', updateSettings);
        settingParticles.addEventListener('change', updateSettings);
        settingContinuous.addEventListener('change', updateSettings);
        settingVibration.addEventListener('change', updateSettings);
        settingSound.addEventListener('change', updateSettings);
        
        settingInterval.addEventListener('input', () => {
            intervalValue.textContent = settingInterval.value;
            detectionInterval = parseInt(settingInterval.value);
            updateSettings();
        });
        
        // Onboarding navigation
        onboardingSkip.addEventListener('click', completeOnboarding);
        onboardingNext.addEventListener('click', nextOnboardingSlide);
        
        // Window resize handler
        window.addEventListener('resize', handleResize);
    }
    
    function initThreeJsScene() {
        // Initialize Three.js for 3D AR effects
        if (!THREE) {
            console.error("Three.js not loaded");
            return;
        }
        
        const width = arOverlay.clientWidth;
        const height = arOverlay.clientHeight;
        
        // Create scene, camera, and renderer
        const scene = new THREE.Scene();
        const camera3D = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ alpha: true });
        
        renderer.setSize(width, height);
        renderer.setClearColor(0x000000, 0); // Transparent background
        
        // Add renderer to AR overlay
        arOverlay.appendChild(renderer.domElement);
        
        // Add ambient light
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        
        // Add directional light
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(0, 10, 10);
        scene.add(directionalLight);
        
        // Position camera
        camera3D.position.z = 5;
        
        // Store scene for later use
        threeJsScene = {
            scene: scene,
            camera: camera3D,
            renderer: renderer
        };
        
        // Start animation loop
        animate();
    }
    
    function animate() {
        requestAnimationFrame(animate);
        
        // Update 3D models if any
        if (threeJsScene && threeJsScene.models) {
            threeJsScene.models.forEach(model => {
                if (model.rotation) {
                    model.rotation.y += 0.01;
                }
            });
        }
        
        // Render the scene
        if (threeJsScene) {
            threeJsScene.renderer.render(threeJsScene.scene, threeJsScene.camera);
        }
    }
    
    function populateSymbolLibrary() {
        // Clear existing symbols
        symbolLibrary.innerHTML = '';
        
        // Add each symbol from the database
        for (const [name, info] of Object.entries(ADINKRA_DB)) {
            const symbolItem = document.createElement('div');
            symbolItem.className = 'symbol-item';
            symbolItem.innerHTML = `
                <h3>${name}</h3>
                <div class="symbol-meaning">${info.meaning}</div>
                <button class="view-symbol-btn" data-symbol="${name}">View Details</button>
            `;
            
            // Add click event to view symbol details
            symbolItem.querySelector('.view-symbol-btn').addEventListener('click', () => {
                displaySymbolDetails(name, info);
            });
            
            symbolLibrary.appendChild(symbolItem);
        }
    }
    
    // ===========================================================================
    // Symbol Detection and AR Functions
    // ===========================================================================
    
    function startContinuousDetection() {
        // Clear any existing timer
        if (detectionTimer) {
            clearInterval(detectionTimer);
        }
        
        // Only set up continuous detection if enabled
        if (settingContinuous.checked) {
            detectionTimer = setInterval(() => {
                detectSymbols();
            }, detectionInterval);
            
            // Do initial detection immediately
            detectSymbols();
        }
    }
    
    function detectSymbols() {
        // Don't start a new detection if one is in progress
        if (isProcessing || !camera.videoWidth) return;
        
        isProcessing = true;
        showLoader(true);
        
        // Draw current video frame to canvas
        ctx.drawImage(camera, 0, 0, canvas.width, canvas.height);
        
        // Get image data from canvas
        canvas.toBlob(blob => {
            // Create form data for API request
            const formData = new FormData();
            formData.append('image', blob);
            
            // Send to Roboflow API
            fetch(`https://detect.roboflow.com/${MODEL_ENDPOINT}?api_key=${API_KEY}&confidence=40&overlap=30&format=json&quality=${detectionQuality}`, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                handleDetectionResults(result);
            })
            .catch(error => {
                console.error('Error detecting symbols:', error);
                showHint("Detection failed. Please try again.");
            })
            .finally(() => {
                isProcessing = false;
                showLoader(false);
            });
        }, 'image/jpeg', 0.8);
    }
    
    function handleDetectionResults(result) {
        // Clear previous detections
        detectedSymbols = [];
        
        // Check if we have any predictions
        if (result.predictions && result.predictions.length > 0) {
            // Process each detected symbol
            result.predictions.forEach(prediction => {
                // Only process if confidence is high enough
                if (prediction.confidence > 0.4) {
                    const symbolName = prediction.class;
                    
                    // Add to detected symbols
                    detectedSymbols.push({
                        name: symbolName,
                        info: ADINKRA_DB[symbolName] || { meaning: "Unknown", description: "No information available" },
                        bounds: prediction,
                        confidence: prediction.confidence
                    });
                }
            });
            
            // Update UI with detected symbols
            if (detectedSymbols.length > 0) {
                updateSymbolInfoDisplay();
                showHint(false);
                
                // Create AR overlay for detected symbols
                createAREffects();
                
                // Provide haptic feedback if enabled
                if (settingVibration.checked && navigator.vibrate) {
                    navigator.vibrate(200);
                }
                
                // Play sound effect if enabled
                if (settingSound.checked) {
                    playDetectionSound();
                }
            } else {
                showHint("No symbols detected. Try moving closer.");
                clearAREffects();
                updateSymbolInfoDisplay(true);
            }
        } else {
            showHint("No symbols detected. Try moving closer.");
            clearAREffects();
            updateSymbolInfoDisplay(true);
        }
    }
    
    function createAREffects() {
        // Clear previous AR effects
        clearAREffects();
        
        if (arEffect === '3d' && setting3dModels.checked) {
            create3DModels();
        } else if (arEffect === 'particles' && settingParticles.checked) {
            createParticleEffects();
        } else {
            createBasicHighlight();
        }
    }
    
    function create3DModels() {
        // Create 3D models for detected symbols using Three.js
        if (!threeJsScene) {
            initThreeJsScene();
        }
        
        // Clear existing models
        if (threeJsScene.models) {
            threeJsScene.models.forEach(model => {
                threeJsScene.scene.remove(model);
            });
        }
        
        threeJsScene.models = [];
        
        // Create a simple 3D model for each detected symbol
        detectedSymbols.forEach(symbol => {
            // Convert detection coordinates to Three.js coordinates
            const x = (symbol.bounds.x / canvas.width) * 2 - 1;
            const y = -((symbol.bounds.y / canvas.height) * 2 - 1);
            const width = (symbol.bounds.width / canvas.width) * 2;
            const height = (symbol.bounds.height / canvas.height) * 2;
            
            // Create geometry based on symbol
            let geometry;
            switch (symbol.name) {
                case 'Sankofa':
                    geometry = new THREE.TorusKnotGeometry(0.3, 0.1, 64, 8);
                    break;
                case 'Gye Nyame':
                    geometry = new THREE.SphereGeometry(0.4, 32, 32);
                    break;
                default:
                    geometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
            }
            
            // Create material
            const material = new THREE.MeshStandardMaterial({
                color: 0xffd700, // Gold color
                metalness: 0.5,
                roughness: 0.3
            });
            
            // Create mesh
            const mesh = new THREE.Mesh(geometry, material);
            
            // Position based on detection
            mesh.position.set(x * 3, y * 3, 0);
            
            // Add to scene
            threeJsScene.scene.add(mesh);
            threeJsScene.models.push(mesh);
        });
    }
    
    function createParticleEffects() {
        // Create particle effect overlays for each detected symbol
        detectedSymbols.forEach(symbol => {
            const particleContainer = document.createElement('div');
            particleContainer.className = 'particle-container';
            particleContainer.style.position = 'absolute';
            particleContainer.style.left = `${symbol.bounds.x - symbol.bounds.width/2}px`;
            particleContainer.style.top = `${symbol.bounds.y - symbol.bounds.height/2}px`;
            particleContainer.style.width = `${symbol.bounds.width}px`;
            particleContainer.style.height = `${symbol.bounds.height}px`;
            
            // Create particles
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Random position within container
                const posX = Math.random() * 100;
                const posY = Math.random() * 100;
                particle.style.left = `${posX}%`;
                particle.style.top = `${posY}%`;
                
                // Random size
                const size = Math.random() * 10 + 5;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // Add animation
                particle.style.animation = `float ${Math.random() * 3 + 2}s ease-in-out infinite`;
                
                particleContainer.appendChild(particle);
            }
            
            arOverlay.appendChild(particleContainer);
        });
    }
    
    function createBasicHighlight() {
        // Create simple highlight boxes for detected symbols
        detectedSymbols.forEach(symbol => {
            const highlight = document.createElement('div');
            highlight.className = 'symbol-highlight';
            highlight.style.position = 'absolute';
            highlight.style.left = `${symbol.bounds.x - symbol.bounds.width/2}px`;
            highlight.style.top = `${symbol.bounds.y - symbol.bounds.height/2}px`;
            highlight.style.width = `${symbol.bounds.width}px`;
            highlight.style.height = `${symbol.bounds.height}px`;
            highlight.style.border = '2px solid #ffd700';
            highlight.style.borderRadius = '5px';
            highlight.style.boxShadow = '0 0 10px rgba(255, 215, 0, 0.7)';
            
            // Add label if info cards are enabled
            if (settingInfoCards.checked) {
                const label = document.createElement('div');
                label.className = 'symbol-label';
                label.textContent = symbol.name;
                label.style.background = 'rgba(0, 0, 0, 0.7)';
                label.style.color = '#fff';
                label.style.padding = '3px 8px';
                label.style.borderRadius = '3px';
                label.style.position = 'absolute';
                label.style.bottom = '100%';
                label.style.left = '0';
                label.style.marginBottom = '5px';
                label.style.fontSize = '14px';
                
                highlight.appendChild(label);
            }
            
            arOverlay.appendChild(highlight);
        });
    }
    
    function clearAREffects() {
        // Clear all AR overlays
        arOverlay.innerHTML = '';
    }
    
    function updateSymbolInfoDisplay(empty = false) {
        if (empty || detectedSymbols.length === 0) {
            symbolInfo.innerHTML = `
                <h2>Detected Symbols</h2>
                <p>Point your camera at an Adinkra symbol to experience it in AR.</p>
            `;
            return;
        }
        
        let infoHTML = `<h2>Detected Symbols (${detectedSymbols.length})</h2>`;
        
        detectedSymbols.forEach(symbol => {
            infoHTML += `
                <div class="detected-symbol">
                    <h3>${symbol.name}</h3>
                    <p><strong>Meaning:</strong> ${symbol.info.meaning}</p>
                    <p>${symbol.info.description}</p>
                </div>
            `;
        });
        
        symbolInfo.innerHTML = infoHTML;
    }
    
    function displaySymbolDetails(name, info) {
        // Create modal for displaying detailed symbol information
        const modal = document.createElement('div');
        modal.className = 'symbol-modal';
        modal.innerHTML = `
            <div class="symbol-modal-content">
                <button class="modal-close">×</button>
                <h2>${name}</h2>
                <div class="symbol-details">
                    <p><strong>Meaning:</strong> ${info.meaning}</p>
                    <p><strong>Origin:</strong> ${info.origin}</p>
                    <p>${info.description}</p>
                    <p><strong>Common Usage:</strong> ${info.usage}</p>
                </div>
                <button class="scan-symbol-btn">Scan This Symbol</button>
            </div>
        `;
        
        // Add close button functionality
        modal.querySelector('.modal-close').addEventListener('click', () => {
            document.body.removeChild(modal);
        });
        
        // Add scan button functionality
        modal.querySelector('.scan-symbol-btn').addEventListener('click', () => {
            document.body.removeChild(modal);
            showHint("Point camera at an actual " + name + " symbol");
        });
        
        document.body.appendChild(modal);
    }
    
    // ===========================================================================
    // UI Control Functions
    // ===========================================================================
    
    function captureImage() {
        // Take a snapshot of the current camera view
        const captureCanvas = document.createElement('canvas');
        captureCanvas.width = camera.videoWidth;
        captureCanvas.height = camera.videoHeight;
        const captureCtx = captureCanvas.getContext('2d');
        
        // Draw current video frame and AR overlay
        captureCtx.drawImage(camera, 0, 0);
        
        // Create snapshot display
        const snapshot = document.createElement('div');
        snapshot.className = 'snapshot-display';
        snapshot.innerHTML = `
            <div class="snapshot-container">
                <button class="snapshot-close">×</button>
                <img src="${captureCanvas.toDataURL('image/jpeg')}" alt="Captured Image">
                <div class="snapshot-actions">
                    <button class="snapshot-save">Save</button>
                    <button class="snapshot-share">Share</button>
                </div>
            </div>
        `;
        
        // Add close button functionality
        snapshot.querySelector('.snapshot-close').addEventListener('click', () => {
            document.body.removeChild(snapshot);
        });
        
        // Add save button functionality
        snapshot.querySelector('.snapshot-save').addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'adinkra-alive-' + new Date().toISOString() + '.jpg';
            link.href = captureCanvas.toDataURL('image/jpeg');
            link.click();
        });
        
        // Add share button functionality
        snapshot.querySelector('.snapshot-share').addEventListener('click', () => {
            if (navigator.share) {
                captureCanvas.toBlob(blob => {
                    const file = new File([blob], 'adinkra-capture.jpg', { type: 'image/jpeg' });
                    navigator.share({
                        title: 'Adinkra Alive AR Capture',
                        text: 'Check out this Adinkra symbol I discovered with the Adinkra Alive AR app!',
                        files: [file]
                    }).catch(err => {
                        console.error('Share failed:', err);
                        alert('Sharing failed. You can save the image instead.');
                    });
                });
            } else {
                alert('Sharing is not supported on this browser. You can save the image instead.');
            }
        });
        
        document.body.appendChild(snapshot);
    }
    
    function toggleCamera() {
        // Toggle between front and back cameras
        facingMode = facingMode === 'environment' ? 'user' : 'environment';
        initCamera();
    }
    
    function toggleFlash() {
        // Toggle camera flash/torch if available
        if (!currentStream) return;
        
        const track = currentStream.getVideoTracks()[0];
        
        // Check if torch is supported
        if (track.getCapabilities && track.getCapabilities().torch) {
            flashEnabled = !flashEnabled;
            
            try {
                track.applyConstraints({
                    advanced: [{ torch: flashEnabled }]
                });
                
                // Update button UI
                toggleFlashBtn.innerHTML = flashEnabled ? 
                    '<i class="fas fa-bolt" style="color: yellow;"></i>' : 
                    '<i class="fas fa-bolt"></i>';
            } catch (err) {
                console.error('Flash not supported:', err);
                alert('Flash/torch is not supported on this device.');
            }
        } else {
            alert('Flash/torch is not supported on this device.');
        }
    }
    
    function toggleFullscreen() {
        const container = document.querySelector('.camera-container');
        
        if (!document.fullscreenElement) {
            if (container.requestFullscreen) {
                container.requestFullscreen();
            } else if (container.webkitRequestFullscreen) {
                container.webkitRequestFullscreen();
            } else if (container.msRequestFullscreen) {
                container.msRequestFullscreen();
            }
            
            fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
            
            fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
        }
    }
    
    function toggleSettingsPanel() {
        settingsPanel.classList.toggle('active');
    }
    
    function toggleARMode() {
        document.body.classList.toggle('ar-mode');
        arModeToggle.classList.toggle('active');
    }
    
    function updateSettings() {
        // Save settings to local storage
        const settings = {
            show3dModels: setting3dModels.checked,
            showInfoCards: settingInfoCards.checked,
            showParticles: settingParticles.checked,
            continuousDetection: settingContinuous.checked,
            detectionInterval: parseInt(settingInterval.value),
            vibrationFeedback: settingVibration.checked,
            soundEffects: settingSound.checked
        };
        
        localStorage.setItem('adinkraAliveSettings', JSON.stringify(settings));
        
        // Update detection interval
        detectionInterval = parseInt(settingInterval.value);
        
        // Restart continuous detection with new settings
        startContinuousDetection();
        
        // Update AR effects if any symbols are detected
        if (detectedSymbols.length > 0) {
            createAREffects();
        }
    }
    
    function changeDetectionQuality(quality) {
        detectionQuality = quality;
        // Trigger new detection with updated quality
        detectSymbols();
    }
    
    function changeAREffect(effect) {
        arEffect = effect;
        // Update AR effects if any symbols are detected
        if (detectedSymbols.length > 0) {
            createAREffects();
        }
    }
    
    // ===========================================================================
    // Onboarding Functions
    // ===========================================================================
    
    function showOnboarding() {
        onboardingOverlay.style.display = 'flex';
        currentOnboardingSlide = 0;
        updateOnboardingSlide();
    }
    
    function nextOnboardingSlide() {
        currentOnboardingSlide++;
        
        if (currentOnboardingSlide >= 4) {
            completeOnboarding();
            return;
        }
        
        updateOnboardingSlide();
    }
    
    function updateOnboardingSlide() {
        const onboardingCard = document.querySelector('.onboarding-card');
        const onboardingImage = document.querySelector('.onboarding-image');
        const onboardingTitle = onboardingCard.querySelector('h2');
        const onboardingText = onboardingCard.querySelector('p');
        const nextBtn = document.getElementById('onboarding-next');
        
        // Update active dot
        onboardingDots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentOnboardingSlide);
        });
        
        // Update content based on slide
        switch (currentOnboardingSlide) {
            case 0:
                onboardingImage.innerHTML = '<i class="fas fa-camera" style="font-size: 50px; color: var(--secondary);"></i>';
                onboardingTitle.textContent = 'Welcome to Adinkra Alive AR';
                onboardingText.textContent = 'Experience Ghana\'s ancient symbols in immersive augmented reality.';
                nextBtn.textContent = 'Next';
                break;
            case 1:
                onboardingImage.innerHTML = '<i class="fas fa-hand-pointer" style="font-size: 50px; color: var(--secondary);"></i>';
                onboardingTitle.textContent = 'Discover Adinkra Symbols';
                onboardingText.textContent = 'Point your camera at Adinkra symbols on fabric, in books, or printed materials to learn their meanings.';
                nextBtn.textContent = 'Next';
                break;
            case 2:
                onboardingImage.innerHTML = '<i class="fas fa-vr-cardboard" style="font-size: 50px; color: var(--secondary);"></i>';
                onboardingTitle.textContent = 'Immersive AR Experience';
                onboardingText.textContent = 'Watch symbols come alive with 3D models and effects that tell their cultural story.';
                nextBtn.textContent = 'Next';
                break;
            case 3:
                onboardingImage.innerHTML = '<i class="fas fa-book-open" style="font-size: 50px; color: var(--secondary);"></i>';
                onboardingTitle.textContent = 'Learn & Share';
                onboardingText.textContent = 'Explore our symbol library to learn more about Ghanaian cultural heritage and share your discoveries.';
                nextBtn.textContent = 'Get Started';
                break;
        }
    }
    
    function completeOnboarding() {
        onboardingOverlay.style.display = 'none';
        localStorage.setItem('adinkraAliveOnboardingCompleted', 'true');
    }
    
    // ===========================================================================
    // Utility Functions
    // ===========================================================================
    
    function showLoader(show) {
        loader.style.display = show ? 'flex' : 'none';
    }
    
    function showHint(message) {
        if (message === false) {
            hintOverlay.style.display = 'none';
            return;
        }
        
        hintOverlay.style.display = 'flex';
        hintOverlay.querySelector('.hint-content h3').textContent = 'Hint';
        hintOverlay.querySelector('.hint-content p').textContent = message;
    }
    
    function showError(message) {
        // Display error message to user
        const errorOverlay = document.createElement('div');
        errorOverlay.className = 'error-overlay';
        errorOverlay.innerHTML = `
            <div class="error-content">
                <h3>Error</h3>
                <p>${message}</p>
                <button id="error-close">OK</button>
            </div>
        `;
        
        document.body.appendChild(errorOverlay);
        
        document.getElementById('error-close').addEventListener('click', () => {
            document.body.removeChild(errorOverlay);
        });
    }
      
    function playDetectionSound() {
        // Play a sound effect when symbol is detected
        if (!settingSound.checked) return;
        
        const sound = new Audio();
        sound.src = 'sounds/detection.mp3'; // Make sure this file exists
        sound.volume = 0.5;
        
        // Handle error gracefully if sound file doesn't exist
        sound.onerror = () => {
            console.warn("Sound file not found, using fallback sound");
            // Create a simple beep sound using the Web Audio API as fallback
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.value = 880; // A5 note
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                gainNode.gain.value = 0.1;
                oscillator.start(0);
                oscillator.stop(audioContext.currentTime + 0.2);
            } catch (err) {
                console.error("Failed to create fallback sound", err);
            }
        };
        
        sound.play().catch(err => {
            console.warn("Failed to play sound, likely due to browser autoplay restrictions", err);
        });
    }
    
    function handleResize() {
        // Update canvas and overlay dimensions
        if (camera.videoWidth) {
            canvas.width = camera.videoWidth;
            canvas.height = camera.videoHeight;
        }
        
        // Update Three.js renderer if it exists
        if (threeJsScene && threeJsScene.renderer) {
            threeJsScene.renderer.setSize(arOverlay.clientWidth, arOverlay.clientHeight);
            threeJsScene.camera.aspect = arOverlay.clientWidth / arOverlay.clientHeight;
            threeJsScene.camera.updateProjectionMatrix();
        }
        
        // Re-create AR effects if symbols are detected
        if (detectedSymbols.length > 0) {
            createAREffects();
        }
    }
    
    // ===========================================================================
    // Offline Support and PWA Functions
    // ===========================================================================
    
    function setupOfflineSupport() {
        // Check for service worker support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }
        
        // Setup offline detection
        window.addEventListener('online', handleOnlineStatusChange);
        window.addEventListener('offline', handleOnlineStatusChange);
        
        // Check initial status
        handleOnlineStatusChange();
    }
    
    function handleOnlineStatusChange() {
        const isOnline = navigator.onLine;
        
        if (!isOnline) {
            // Show offline notification
            const offlineNotice = document.createElement('div');
            offlineNotice.className = 'offline-notice';
            offlineNotice.innerHTML = `
                <i class="fas fa-wifi"></i> You're offline. Some features may be limited.
            `;
            
            // Remove any existing notice first
            const existingNotice = document.querySelector('.offline-notice');
            if (existingNotice) {
                document.body.removeChild(existingNotice);
            }
            
            document.body.appendChild(offlineNotice);
            
            // Limit functionality when offline
            disableOnlineFeatures();
        } else {
            // Remove offline notice if it exists
            const offlineNotice = document.querySelector('.offline-notice');
            if (offlineNotice) {
                document.body.removeChild(offlineNotice);
            }
            
            // Re-enable online features
            enableOnlineFeatures();
        }
    }
    
    function disableOnlineFeatures() {
        // Disable features that require internet
        settingContinuous.disabled = true;
        document.getElementById('quality-selector').disabled = true;
        
        // Show hint about limited functionality
        showHint("Limited functionality in offline mode. Detection may not work.");
    }
    
    function enableOnlineFeatures() {
        // Re-enable online features
        settingContinuous.disabled = false;
        document.getElementById('quality-selector').disabled = false;
        
        // Hide offline hint if showing
        if (hintOverlay.querySelector('.hint-content p').textContent.includes("offline")) {
            showHint(false);
        }
    }
    
    // ===========================================================================
    // Data Management Functions
    // ===========================================================================
    
    function cacheSymbolData() {
        // Cache symbol data for offline use
        if ('caches' in window) {
            const cache = window.caches.open('adinkra-data')
                .then(cache => {
                    // Cache the symbol database
                    cache.put('symbols', new Response(JSON.stringify(ADINKRA_DB)));
                    
                    // Cache any 3D models or resources
                    // This is just a placeholder - actual model caching would depend on your resources
                    console.log('Symbol data cached for offline use');
                })
                .catch(err => {
                    console.error('Failed to cache symbol data:', err);
                });
        }
    }
    
    function loadCachedSymbolData() {
        // Try to load symbol data from cache if online data fails
        if ('caches' in window) {
            return window.caches.match('symbols')
                .then(response => {
                    if (response) {
                        return response.json();
                    }
                    return null;
                })
                .catch(err => {
                    console.error('Failed to load cached symbol data:', err);
                    return null;
                });
        }
        return Promise.resolve(null);
    }
    
    // ===========================================================================
    // Analytics & Tracking Functions
    // ===========================================================================
    
    function trackSymbolDetection(symbolName) {
        // Track symbol detection for analytics
        if (window.gtag) {
            gtag('event', 'symbol_detected', {
                'symbol_name': symbolName,
                'detection_quality': detectionQuality,
                'ar_effect': arEffect
            });
        }
    }
    
    function trackFeatureUsage(featureName) {
        // Track feature usage for analytics
        if (window.gtag) {
            gtag('event', 'feature_used', {
                'feature_name': featureName
            });
        }
    }
    
    // ===========================================================================
    // Custom AR Model Functions
    // ===========================================================================
    
    function loadSymbolModel(symbolName) {
        // This would normally load a 3D model for the specific symbol
        // For this implementation, we'll create geometric primitives based on the symbol name
        
        if (!threeJsScene) return null;
        
        let geometry, material;
        
        // Create different geometries based on symbol
        switch(symbolName) {
            case 'Gye Nyame':
                geometry = new THREE.TorusGeometry(0.5, 0.2, 16, 50);
                material = new THREE.MeshStandardMaterial({ 
                    color: 0xffd700,
                    metalness: 0.8,
                    roughness: 0.2
                });
                break;
            case 'Sankofa':
                geometry = new THREE.TorusKnotGeometry(0.4, 0.1, 64, 8);
                material = new THREE.MeshStandardMaterial({ 
                    color: 0xcd7f32,
                    metalness: 0.5,
                    roughness: 0.3
                });
                break;
            case 'Duafe':
                geometry = new THREE.CylinderGeometry(0.3, 0.3, 0.8, 32);
                material = new THREE.MeshStandardMaterial({ 
                    color: 0xA0522D,
                    metalness: 0.2,
                    roughness: 0.8
                });
                break;
            case 'Dwennimmen':
                geometry = new THREE.ConeGeometry(0.5, 1, 32);
                material = new THREE.MeshStandardMaterial({ 
                    color: 0x8B4513,
                    metalness: 0.3,
                    roughness: 0.7
                });
                break;
            case 'Akoma':
                // Create a heart shape
                const heartShape = new THREE.Shape();
                heartShape.moveTo(0, 0.5);
                heartShape.bezierCurveTo(0.5, 0.5, 0.5, 0, 0, -0.5);
                heartShape.bezierCurveTo(-0.5, 0, -0.5, 0.5, 0, 0.5);
                
                geometry = new THREE.ExtrudeGeometry(heartShape, {
                    depth: 0.2,
                    bevelEnabled: true,
                    bevelSegments: 2,
                    bevelSize: 0.1,
                    bevelThickness: 0.1
                });
                material = new THREE.MeshStandardMaterial({ 
                    color: 0xff0000,
                    metalness: 0.2,
                    roughness: 0.5
                });
                break;
            default:
                geometry = new THREE.BoxGeometry(0.6, 0.6, 0.6);
                material = new THREE.MeshStandardMaterial({ 
                    color: 0x4682B4,
                    metalness: 0.4,
                    roughness: 0.6
                });
        }
        
        const mesh = new THREE.Mesh(geometry, material);
        return mesh;
    }
    
    // ===========================================================================
    // Educational Content Functions
    // ===========================================================================
    
    function showSymbolHistory(symbolName) {
        // Display educational content about the selected symbol
        const symbol = ADINKRA_DB[symbolName];
        
        if (!symbol) return;
        
        const historyModal = document.createElement('div');
        historyModal.className = 'history-modal';
        historyModal.innerHTML = `
            <div class="history-modal-content">
                <button class="modal-close">×</button>
                <h2>${symbolName} - Historical Context</h2>
                <div class="history-content">
                    <p><strong>Cultural Significance:</strong> ${symbol.meaning}</p>
                    <p><strong>Historical Origin:</strong> ${symbol.origin}</p>
                    <p>${symbol.description}</p>
                    <p><strong>Traditional Usage:</strong> ${symbol.usage}</p>
                    <div class="history-gallery">
                        <h3>Traditional Applications</h3>
                        <div class="placeholder-gallery">
                            <div class="placeholder-image">Historical Example</div>
                            <div class="placeholder-image">Traditional Use</div>
                            <div class="placeholder-image">Modern Adaptation</div>
                        </div>
                    </div>
                </div>
                <button class="learn-more-btn">Learn More Online</button>
            </div>
        `;
        
        // Add close button functionality
        historyModal.querySelector('.modal-close').addEventListener('click', () => {
            document.body.removeChild(historyModal);
        });
        
        // Add learn more button functionality
        historyModal.querySelector('.learn-more-btn').addEventListener('click', () => {
            window.open(`https://en.wikipedia.org/wiki/Adinkra_symbols`, '_blank');
        });
        
        document.body.appendChild(historyModal);
    }
    
    // ===========================================================================
    // Main Initialization
    // ===========================================================================
    
    // Initialize everything when the page loads
    initialize();
    
    // Set up offline support
    setupOfflineSupport();
    
    // Cache symbol data for offline use
    cacheSymbolData();
    
    // Export functions for use in HTML event handlers
    window.changeDetectionQuality = changeDetectionQuality;
    window.changeAREffect = changeAREffect;
});
    </script>
</body>
</html>